<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>شدوان للعقارات</title>
    <link href="../output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="font-sans text-gray-700">
    <!-- Navbar -->
    <nav class="bg-white shadow-md fixed top-0 w-full z-50">
      <div
        class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"
      >
        <button
          title="زر القائمة"
          class="md:hidden text-gray-700"
          id="menu-btn"
        >
          <i class="fas fa-bars fa-lg"></i>
        </button>
        <div
          id="menu"
          class="absolute top-full right-0 w-full bg-white flex flex-col space-y-4 p-4 transform transition-all duration-300 ease-in-out opacity-0 -translate-y-5 md:pointer-events-auto pointer-events-none md:static md:w-auto md:flex md:flex-row md:items-center md:space-y-0 md:space-x-6 md:opacity-100 md:translate-y-0 md:bg-transparent md:p-0 md:justify-end z-40"
        >
          <a href="../index.html" class="hover:text-blue-700">الرئيسية</a>
          <a href="properties-list.html" class="hover:text-blue-700"
            >العقارات</a
          >
          <a href="about.html" class="hover:text-blue-700">من نحن</a>
          <a href="contact.html" class="hover:text-blue-700">اتصل بنا</a>
        </div>
        <div class="flex items-center font-bold text-lg text-gray-900">
          <img
            src="../img/logo.png"
            alt="شعار عقارات الغردقة"
            class="h-14 w-auto mr-2 ml-2"
          />
        </div>
      </div>
    </nav>

    <main class="max-w-6xl mx-auto mt-16 p-6 space-y-10">
      <section>
        <h2 class="text-3xl font-bold leading-tight"></h2>
        <img
          src=""
          alt="Main"
          class="w-full h-64 sm:h-80 md:h-[75vh] object-cover rounded-lg mt-4"
        />

        <div
          id="thumbnail-gallery"
          class="flex gap-x-4 overflow-x-auto overflow-y-hidden m-4 scrollbar-hide"
        >
          <img src="" alt="Image" class="h-28 w-48 object-cover rounded-lg" />
        </div>

        <div class="flex flex-wrap justify-center gap-6 mt-6 text-blue-700">
          <div class="flex items-center space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-blue-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 10h4v10H3V10zm14 0h4v10h-4V10zM10 3h4v7h-4V3zM10 14h4v6h-4v-6z"
              />
            </svg>
            <span id="property-type"></span>
          </div>

          <div class="flex items-center space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-blue-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 7h18M3 12h18M3 17h18"
              />
            </svg>
            <span id="property-area"></span>
          </div>

          <div class="flex items-center space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-blue-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 22s8-4.5 8-12a8 8 0 10-16 0c0 7.5 8 12 8 12z"
              />
            </svg>
            <span id="property-location"></span>
          </div>
        </div>

        <div class="bg-gray-100 p-4 mt-4 flex items-center justify-between">
          <p id="property-price" class="text-lg font-semibold">
            السعر: <span class="text-blue-700 font-bold">1</span> جنيه/شهر
          </p>
          <a
            href="contact.html"
            class="px-4 py-2 border border-blue-700 text-blue-700 hover:bg-blue-700 hover:text-white rounded"
          >
            تواصل معنا
          </a>
        </div>
      </section>

      <section class="bg-gray-100 p-6 rounded">
        <h3 class="text-lg font-semibold mb-4">الخصائص الأساسية</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <p>
            <strong>المدينة: </strong
            ><span id="property-location2">الغردقة</span>
          </p>
          <p><strong>النوع: </strong><span id="property-type2">شقة</span></p>
          <p>
            <strong>الحالة: </strong><span id="property-status">إيجار</span>
          </p>
          <p><strong>المساحة: </strong><span id="property-area2"></span> م²</p>
        </div>
      </section>

      <section class="bg-gray-100 p-6 rounded">
        <h3 class="text-lg font-semibold mb-4">الوصف</h3>
        <p id="property-description" class="text-sm text-gray-700">
          نص الوصف هنا
        </p>
      </section>
    </main>

    <!-- Image Modal with Prev/Next -->
    <div
      id="imageModal"
      class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300"
    >
      <img
        title="img"
        id="modalImage"
        class="max-w-full max-h-full rounded shadow-lg transition-all duration-300 transform opacity-0 scale-90"
      />

      <button
        onclick="showPrevImage(event)"
        class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/40 bg-opacity-50 hover:bg-opacity-80 text-white text-3xl px-4 py-2 rounded-full shadow-lg transition"
        title="التالي"
      >
        ‹
      </button>
      <button
        onclick="showNextImage(event)"
        class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/40 bg-opacity-50 hover:bg-opacity-80 text-white text-3xl px-4 py-2 rounded-full shadow-lg transition"
        title="السابق"
      >
        ›
      </button>

      <button
        onclick="closeModal()"
        class="absolute top-4 right-4 text-white text-2xl bg-black/40 bg-opacity-50 hover:bg-opacity-80 px-4 py-2 rounded-full shadow-lg transition"
        title="إغلاق"
      >
        ✕
      </button>
    </div>

    <section class="max-w-6xl mx-auto mt-3 p-6">
      <h3 class="text-2xl font-bold mb-4">عقارات موصى بها</h3>
      <div
        id="recommended-properties"
        class="flex gap-4 overflow-x-auto overflow-y-hidden scrollbar-hide snap-x snap-mandatory"
      >
        <!-- Cards will be inserted here -->
      </div>
    </section>

    <footer class="bg-gray-900 text-gray-300 py-10">
      <div
        class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 px-4"
      >
        <div>
          <div class="flex items-center mb-2">
            <img src="../img/footer.png" alt="الشعار" class="h-6 w-auto ml-2" />
            <h4 class="text-white font-bold text-base">شدوان للعقارات</h4>
          </div>
          <p class="text-sm">
            شريكك الموثوق للعثور على العقار المثالي في الغردقة. نحن متخصصون في
            الفلل الفاخرة، الشقق الحديثة، واستثمارات الأراضي المتميزة على ساحل
            البحر الأحمر.
          </p>
          <div class="flex space-x-4 mt-4 text-white text-lg">
            <a href="https://www.facebook.com/profile.php?id=61579728182774&sk=about" class="hover:text-blue-400" target="_blank"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="https://www.instagram.com/shed.wan020/" class="hover:text-pink-400" target="_blank"
              ><i class="fab fa-instagram"></i
            ></a>
          </div>
        </div>

        <div>
          <h4 class="text-white font-bold mb-2">معلومات الاتصال</h4>
          <ul class="text-sm space-y-2">
            <li class="flex items-center">
              <img src="../img/contact.png" alt="هاتف" class="h-4 w-4 ml-2" />
              <ul>
                <li>
                  <a href="tel:+201000563882">01000563882</a>

                  <a href="tel:+201066882220">01066882220</a>
                </li>
                <li>
                  <a href="tel:+201019383550">01019383550</a>

                  <a href="tel:+201012762292">01012762292</a>
                </li>
              </ul>
            </li>
            <li class="flex items-center">
              <img src="../img/mail.png" alt="بريد" class="h-4 w-4 ml-2" />
              <a href="mailto:shedwanproperties@gmail.com"
                >shedwanproperties@gmail.com</a
              >
            </li>
            <li class="flex items-center">
              <img
                src="../img/location2.png"
                alt="موقع"
                class="h-4 w-4 ml-2"
              />الغردقة، البحر الأحمر، مصر
            </li>
          </ul>
        </div>

        <div>
          <h4 class="text-white font-bold mb-2">روابط سريعة</h4>
          <ul class="text-sm space-y-2">
            <li>
              <a href="../index.html" class="hover:underline">الرئيسية</a>
            </li>
            <li>
              <a href="properties-list.html" class="hover:underline"
                >العقارات</a
              >
            </li>
            <li><a href="about.html" class="hover:underline">من نحن</a></li>
            <li><a href="contact.html" class="hover:underline">اتصل بنا</a></li>
          </ul>
        </div>
      </div>
      <div
        class="border-t border-gray-700 mt-8 pt-4 text-center text-sm text-gray-400"
      >
        © 2025 عقارات الغردقة. جميع الحقوق محفوظة.
      </div>
    </footer>
    <script>
      const menuBtn = document.getElementById("menu-btn");
      const menu = document.getElementById("menu");

      menuBtn.addEventListener("click", () => {
        const isOpen = menu.classList.contains("menu-open");

        if (isOpen) {
          // Close menu
          menu.classList.remove("menu-open");
          menu.classList.add(
            "opacity-0",
            "-translate-y-10",
            "pointer-events-none"
          );
          menu.classList.remove(
            "opacity-100",
            "translate-y-0",
            "pointer-events-auto"
          );
        } else {
          // Open menu with animation
          menu.classList.add("menu-open");
          menu.classList.remove(
            "opacity-0",
            "-translate-y-10",
            "pointer-events-none"
          );
          // Force reflow so transition triggers
          void menu.offsetWidth;
          menu.classList.add(
            "opacity-100",
            "translate-y-0",
            "pointer-events-auto"
          );
        }
      });

      document.addEventListener("click", (e) => {
        const menuIsOpen = menu.classList.contains("menu-open");
        const isSmallScreen = window.innerWidth < 768;

        if (
          menuIsOpen &&
          isSmallScreen &&
          !menu.contains(e.target) &&
          !menuBtn.contains(e.target)
        ) {
          // Close menu
          menu.classList.remove("menu-open");
          menu.classList.add(
            "opacity-0",
            "-translate-y-10",
            "pointer-events-none"
          );
          menu.classList.remove(
            "opacity-100",
            "translate-y-0",
            "pointer-events-auto"
          );
        }
      });

      document.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const propertyId = params.get("id");

        if (!propertyId) {
          document.body.innerHTML =
            "<h1 class='text-center mt-20'>Property ID not provided.</h1>";
          return;
        }

        try {
          const res = await fetch(
            `/api/Property/GetPropertyById/${propertyId}`
          );
          const result = await res.json();

          if (!result.succeeded) {
            document.body.innerHTML =
              "<h1 class='text-center mt-20'>Failed to load property.</h1>";
            return;
          }

          const property = result.data;

          // Now populate DOM elements — you can select them by id or class and inject content.
          document.querySelector("h2").textContent = property.name;
          document.querySelector("img[alt='Main']").src =
            property.mainImage?.imageURL;
          document.querySelector("img[alt='Main']").onclick = () =>
            openModal(property.mainImage?.imageURL);

          const gallery = document.getElementById("thumbnail-gallery");

          imageList = property.images.map((img) => img.imageURL);

          // main image
          const mainImg = document.querySelector("img[alt='Main']");
          mainImg.src = property.mainImage?.imageURL;
          mainImg.onclick = () => openModal(property.mainImage?.imageURL);

          // thumbnails
          gallery.innerHTML = imageList
            .map(
              (imgURL) => `
                <img
                  src="${imgURL}"
                  alt="Image"
                  onclick="openModal('${imgURL}')"
                  class="h-28 w-48 object-cover rounded-lg cursor-pointer hover:scale-105 transition-transform duration-200"
                />
              `
            )
            .join("");

          // Include main image in modal list if needed
          if (property.mainImage?.imageURL) {
            imageList.unshift(property.mainImage.imageURL);
          }

          document.getElementById("property-type").textContent = property.type;
          document.getElementById("property-area").textContent =
            property.area + " م²";
          document.getElementById("property-location").textContent =
            property.location;

          if (property.status === "إيجار") {
            document.getElementById(
              "property-price"
            ).innerHTML = `إيجار: <span class="text-blue-700 font-bold">${property.price}</span> جنيه مصري/شهر`;
          } else {
            document.getElementById(
              "property-price"
            ).innerHTML = `سعر البيع: <span class="text-blue-700 font-bold">${property.price}</span> جنيه مصري`;
          }

          document.getElementById("property-location2").textContent =
            property.location;
          document.getElementById("property-type2").textContent = property.type;
          document.getElementById("property-status").textContent =
            property.status;
          document.getElementById("property-area2").textContent = property.area;

          document.getElementById("property-description").textContent =
            property.description;
        } catch (err) {
          console.error("Failed to load property:", err);
          document.body.innerHTML =
            "<h1 class='text-center mt-20'>Error loading property details.</h1>";
        }
      });

      let imageList = []; // All image URLs
      let currentImageIndex = 0;

      // Open modal and track image index
      function openModal(src) {
        currentImageIndex = imageList.indexOf(src);
        if (currentImageIndex === -1) currentImageIndex = 0;

        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");

        modalImg.classList.remove("opacity-0", "scale-90");
        modalImg.classList.add("opacity-100", "scale-100");
        modalImg.src = src;

        modal.classList.remove("opacity-0", "pointer-events-none");
        modal.classList.add("opacity-100", "pointer-events-auto");
      }

      function closeModal() {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");

        modal.classList.remove("opacity-100");
        modal.classList.add("opacity-0");
        modal.classList.add("pointer-events-none");

        modalImg.classList.remove("opacity-100", "scale-100");
        modalImg.classList.add("opacity-0", "scale-90");
      }

      // Show next image
      function showNextImage(event) {
        event.stopPropagation(); // prevent modal close
        currentImageIndex = (currentImageIndex + 1) % imageList.length;
        document.getElementById("modalImage").src =
          imageList[currentImageIndex];
      }

      // Show previous image
      function showPrevImage(event) {
        event.stopPropagation();
        currentImageIndex =
          (currentImageIndex - 1 + imageList.length) % imageList.length;
        document.getElementById("modalImage").src =
          imageList[currentImageIndex];
      }

      function showNextImage(event) {
        event.stopPropagation();
        currentImageIndex = (currentImageIndex + 1) % imageList.length;
        transitionImage(imageList[currentImageIndex]);
      }

      function showPrevImage(event) {
        event.stopPropagation();
        currentImageIndex =
          (currentImageIndex - 1 + imageList.length) % imageList.length;
        transitionImage(imageList[currentImageIndex]);
      }

      function transitionImage(newSrc) {
        const img = document.getElementById("modalImage");
        img.classList.remove("opacity-100", "scale-100");
        img.classList.add("opacity-0", "scale-90");

        setTimeout(() => {
          img.src = newSrc;
          img.classList.remove("opacity-0", "scale-90");
          img.classList.add("opacity-100", "scale-100");
        }, 200);
      }
      document.addEventListener("keydown", (event) => {
        const modal = document.getElementById("imageModal");
        const isModalOpen = modal.classList.contains("opacity-100");

        if (!isModalOpen) return;

        if (event.key === "ArrowRight") {
          showNextImage(event);
        } else if (event.key === "ArrowLeft") {
          showPrevImage(event);
        } else if (event.key === "Escape") {
          closeModal();
        }
      });

      async function loadRecommendedProperties() {
        try {
          const res = await fetch(
            "/api/Property/GetAllProperties?pageNumber=1&pageSize=6"
          );
          const data = await res.json();

          if (!data.succeeded) {
            console.warn("Failed to fetch recommended properties");
            return;
          }

          const container = document.getElementById("recommended-properties");
          container.innerHTML = data.data
            .map((property) => {
              return `
      <div class="min-w-[250px] bg-white rounded-lg shadow-md hover:shadow-2xl hover:scale-105 transition-transform duration-300 cursor-pointer snap-start">
        <a href="property-details.html?id=${property.id}">
          <img
            src="${
              property.mainImage?.imageURL ||
              "https://via.placeholder.com/250x150"
            }"
            alt="${property.name}"
            class="w-full h-40 object-cover rounded-t-lg"
          />
          <div class="p-4">
            <h4 class="font-bold text-lg truncate">${property.name}</h4>
            <p class="text-sm text-gray-600 truncate">${property.location}</p>
            <p class="text-sm text-blue-700 mt-2 font-semibold">
              ${property.status === "إيجار" ? "إيجار: " : "سعر البيع: "}
              ${property.price} جنيه
            </p>
          </div>
        </a>
      </div>
    `;
            })
            .join("");
        } catch (error) {
          console.error("Error loading recommended properties", error);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadRecommendedProperties();
      });
    </script>
  </body>
</html>
